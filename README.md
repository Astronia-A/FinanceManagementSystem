# 基于 Llama 3.2 与 RAG 的智能财务管理系统

这是一个集成了本地大模型（Llama 3.2）、检索增强生成（RAG）技术与可视化仪表盘的企业级财务管理系统。旨在提供数据安全、响应迅速且具备智能分析能力的本地化财务解决方案。

---

## 🛠️ 1. 环境与软件准备

在运行本项目之前，请确保电脑已安装以下基础软件：

1.  **Python** (版本 3.10 或更高)
2.  **代码编辑器**: PyCharm 或 VS Code
3.  **Ollama**: 用于本地运行大模型 [下载地址](https://ollama.com/)

---

## 📦 2. 依赖安装

### Python 库安装
打开终端 (Terminal / CMD)，运行以下命令安装所需的第三方库：

```bash
pip install streamlit pandas openpyxl plotly captcha langchain langchain-community langchain-ollama faiss-cpu pypdf numpy
```

### AI 模型下载
确保 **Ollama** 软件已在后台运行，然后在终端依次执行以下命令，下载所需的两个模型：

1.  **下载主对话模型 (Llama 3.2 3B)**：
    ```bash
    ollama pull llama3.2
    ```

2.  **下载向量嵌入模型 (Nomic Embed Text)**：
    *用于将知识库文本转化为数学向量，支持 RAG 功能*
    ```bash
    ollama pull nomic-embed-text
    ```

---

## 🚀 3. 运行指南

### 启动系统
在项目根目录下，通过终端运行以下命令：

```bash
streamlit run app.py
```

### 登录系统
系统启动后会自动打开浏览器，默认管理员账号如下（系统首次运行时自动创建）：

*   **用户名**: `admin`
*   **密码**: `123456`
*   **验证码**: 根据屏幕显示或控制台提示输入

---

## 🧠 4. 技术栈与核心原理

### 4.1 技术架构
*   **前端交互**: `Streamlit` (快速构建数据可视化 Web 应用)
*   **数据处理**: `Pandas` (数据清洗与分析) + `Plotly` (交互式图表)
*   **数据存储**:
    *   **SQLite**: 存储结构化的财务流水、用户账号（轻量级关系型数据库）。
    *   **FAISS**: 存储非结构化的财会知识库索引（高性能向量数据库）。
*   **AI 引擎**: `LangChain` (大模型应用开发框架) + `Ollama` (本地模型服务)。
*   **安全机制**: `SHA-256` 密码哈希加密 + `Captcha` 图形验证码。

### 4.2 核心原理：RAG (检索增强生成)
本系统的“智能分析”功能不依赖模型自带的训练数据，而是基于**RAG**技术，流程如下：

1.  **知识注入 (Indexing)**:
    *   用户上传 PDF/TXT 财会法规。
    *   系统使用 `RecursiveCharacterTextSplitter` 将长文档切分为微小的片段 (Chunk)。
    *   调用 `nomic-embed-text` 模型将文字片段转化为**向量 (Vector)**，存入 FAISS 本地数据库。

2.  **智能检索 (Retrieval)**:
    *   当用户点击“生成报告”时，系统将当前的财务摘要（如收支总额、大额支出）转化为向量。
    *   系统在 FAISS 数据库中搜索与当前财务状况最相关的知识库片段（如税务风险提示）。

3.  **生成回答 (Generation)**:
    *   系统构建 Prompt（提示词）：`[角色: 审计师] + [背景知识: 检索到的片段] + [用户数据: 财务摘要]`。
    *   将 Prompt 发送给 **Llama 3.2** 模型。
    *   模型基于检索到的事实生成最终的分析报告。

### 4.3 为什么选择 Llama 3.2？
*   **轻量高效**: 3B 参数量，无需昂贵显卡，普通笔记本即可流畅运行。
*   **隐私安全**: 数据完全在本地运行，不上传云端，符合财务数据保密要求。
*   **指令遵循**: 相比同类小模型，Llama 3.2 能更好地遵循 RAG 系统的复杂指令。

---

## 📂 5. 项目文件说明

*   `app.py`: 系统主入口，包含 UI 界面、登录逻辑、图表绘制与数据库操作。
*   `ai_engine.py`: 后端 AI 核心，负责连接 Ollama、处理 RAG 流程及向量计算。
*   `finance_system.db`: 自动生成的 SQLite 数据库文件（存账单）。
*   `faiss_index/`: 自动生成的向量索引文件夹（存知识库记忆）。
```
